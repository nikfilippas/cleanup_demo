language: python
cache:
  directories:
  - "$TRAVIS_BUILD_DIR/build/GSL/src"
  - "$TRAVIS_BUILD_DIR/build/FFTW/src"
  - "$TRAVIS_BUILD_DIR/build/SWIG/src"
  - "$TRAVIS_BUILD_DIR/build/CLASS/src"
  - "$TRAVIS_BUILD_DIR/build/ANGPOW/src"
  - "$HOME/miniconda"
matrix:
  include:
  - os: linux
    python: 2.7
    sudo: required
    env: TOXENV=py27
  - os: linux
    sudo: required
    python: 3.6
    env: TOXENV=py36
  - os: osx
    language: generic
    env: TOXENV=py27
  - os: osx
    language: generic
    env: TOXENV=py36
install:
- "./.travis/install.sh"
- if ! [[ $TRAVIS_OS_NAME == "linux" ]]; then source $HOME/miniconda/bin/activate;
  fi
- if ! [[ $TRAVIS_OS_NAME == "linux" ]]; then hash -r ; fi
- if ! [[ $TRAVIS_OS_NAME == "linux" ]]; then source activate test-environment ; fi
- export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib
- export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/local/lib/pkgconfig
- cmake --version
- python --version
script:
- python setup.py build
- nosetests tests/run_tests.py --all --debug --detailed-errors --verbose --process-restartworker
  --with-coverage --cover-package=pyccl
- make -Cbuild && sudo make -Cbuild install
- check_ccl
after_success:
- coveralls
deploy:
  provider: pypi
  user: desc-ccl
  password:
    secure: U+AyNARVru3eJaMxgQBc712oANd86uaO2gDZ5crG//6Px/PEWypsL/McrZK25BhRbaIyVoJrF51KQ4rAjaAlnrquVYlOqvx+ZMJuoWK54RbRHT9pnlqm6btZrBVBp1ggmlyoQA0p56ucy7JBwbG5uJ2eQmU0kz0iGDy3EWqfYACqilQsm2qz3/spq6nqQnHTAylhz25HOUU4lhomWnsi+lo530FpL8CZgLFzfs/ysmXHOoxNjhedj6eEvy1kV12sPU75qniRpqWKGB/GcIaySeo7kUw1CpByV2qjCTcP9B4hjfRZy8l3L71vv+p2TJdZU6olm7XERghZvS4BJWm9pR4S5SzP6NoyRHKdNFIZc3lHqm6qMbzOfCL5MUdQSpzrusTOrzySVR3xoyS+SCOtOwxMxgOYztKhcM1IViFhBhGQU6LKg+QQp7qiffJ/9ChAa8PSldwaDdZvipb8XIasr6Pg3R8jP/od2J82ljG8fQQE/gXr9iXkePaY9DRhHQtentchQn6WIY3JFUI3YA/MnPQprL+EtJR6toSDux/Q7Tm+pbiIjhk2dG7iKfABJPpOUEQrnU62ik9vzAHO2MACAY3kWYuy/RhtYt6uSConZD7kbSyxv/YOl0z6N8VX9ar3aipLi/d3U7zQGdgZNs5tQjNiLLO6Yx7O08b7U6rtAp4=
  on:
    tags: true
    branch: master
