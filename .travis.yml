language: python
cache:
  directories:
  - "$TRAVIS_BUILD_DIR/build/GSL/src"
  - "$TRAVIS_BUILD_DIR/build/FFTW/src"
  - "$TRAVIS_BUILD_DIR/build/SWIG/src"
  - "$TRAVIS_BUILD_DIR/build/CLASS/src"
  - "$TRAVIS_BUILD_DIR/build/ANGPOW/src"
  - "$HOME/miniconda"
matrix:
  include:
  - os: linux
    python: 2.7
    sudo: required
    env: TOXENV=py27
  - os: linux
    sudo: required
    python: 3.6
    env: TOXENV=py36
  - os: osx
    language: generic
    env: TOXENV=py27
  - os: osx
    language: generic
    env: TOXENV=py36
install:
- "./.travis/install.sh"
- if ! [[ $TRAVIS_OS_NAME == "linux" ]]; then source $HOME/miniconda/bin/activate;
  fi
- if ! [[ $TRAVIS_OS_NAME == "linux" ]]; then hash -r ; fi
- if ! [[ $TRAVIS_OS_NAME == "linux" ]]; then source activate test-environment ; fi
- export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib
- export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/local/lib/pkgconfig
- cmake --version
- python --version
script:
- python setup.py build
- nosetests tests/run_tests.py --all --debug --detailed-errors --verbose --process-restartworker
  --with-coverage --cover-package=pyccl
- sudo make -Cbuild install
- check_ccl
after_success:
- coveralls
deploy:
  provider: pypi
  user: desc-ccl
  password:
    secure: d903I7Fa08AaAwBwTgddmy8n4JbeGtcrfPFLHKLM9Uxrt7zFsKO4xqxd1BCmarAD4Hx0WcmzlWD1W7kbr9wHHFuiymj6kglKgMH2AAXZdA441BWHZsOIqAYIgJBCVxxQEAdGpbvrSgTGbyQW1b/37EWl617v26WRqDhAcnsdpOY1JByw4SwuyEDBvqN5tpmJfygc/GwRCP/03yUmOr4lJQXrvBpRKoO48fhi3MjkUnOYDn/pNy1DypxA/ECtjZy2BZJbKldW+eKdVxAo0naDF8hjNMuyNj0iyhPyHx3/6cmBNutDM1Y0LLcexuXh4BCAQwdlgCuVHeDEhjyguH87WOBJZ1+UJOSmfiBwEd0T7ZQWeEhDROGw+NbWlY4/wZlAFaietVh0ppJEXAOaBQ8Z0mzH6P9DXE9U0cPA6Di3MPHFoH+ORkjqpG4jA1CHTHyvjnxjjmKzKyPqzOgjMpsEilHDQYpemg1gIx4YQrWix9BkVv8hnUKpV5i1VfCrIoPLXsl2iHSXn5l+KhIpiIxCsIr0odz6O/nedbBafvTd44480xdXN1G4avGcM4YH6d2n3qsQvO2sJJxFKKsFIBAkKAe1yCq+V18Op+QG2U9a2tGCUJ6/rTuk7Jg04eKggWgDa3vIWfkZxTmZ71Nv1dPzTqUCLo5dIq7MvSwlQVpFMGc=
  on:
    tags: true
    branch: master
